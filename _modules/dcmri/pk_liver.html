
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>dcmri.pk_liver &#8212; dcmri 0.6.8 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=cd8af66b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=ac3b80e6"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/dcmri/pk_liver';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/tristan-logo.jpg" class="logo__image only-light" alt="dcmri 0.6.8 documentation - Home"/>
    <script>document.write(`<img src="../../_static/tristan-logo.jpg" class="logo__image only-dark" alt="dcmri 0.6.8 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../tutorial/index.html">
    Tutorial
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../reference/index.html">
    Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../generated/examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../contribute/index.html">
    Contribute
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../releases/index.html">
    Releases
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../about/index.html">
    About
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/QIB-Sheffield/dcmri" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../tutorial/index.html">
    Tutorial
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../reference/index.html">
    Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../generated/examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../contribute/index.html">
    Contribute
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../releases/index.html">
    Releases
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../about/index.html">
    About
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/QIB-Sheffield/dcmri" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">dcmri.pk_liver</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for dcmri.pk_liver</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">dcmri</span> <span class="k">as</span> <span class="nn">dc</span>


<div class="viewcode-block" id="conc_liver">
<a class="viewcode-back" href="../../generated/api/dcmri.conc_liver.html#dcmri.conc_liver">[docs]</a>
<span class="k">def</span> <span class="nf">conc_liver</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">kinetics</span><span class="o">=</span><span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Concentration in liver tissue.</span>

<span class="sd">    Args:</span>
<span class="sd">        ca (array-like): concentration in the arterial input.</span>
<span class="sd">        params (tuple): free model parameters.</span>
<span class="sd">        t (array_like, optional): the time points in sec of the input function *ca*. If *t* is not provided, the time points are assumed to be uniformly spaced with spacing *dt*. Defaults to None.</span>
<span class="sd">        dt (float, optional): spacing in seconds between time points for uniformly spaced time points. This parameter is ignored if *t* is explicity provided. Defaults to 1.0.</span>
<span class="sd">        kinetics (str, optional): Kinetics of the tissue, either &#39;EC&#39;, &#39;IC&#39;, &#39;ICNSU&#39; or &#39;ICNS&#39;- see below for detail. Defaults to &#39;EC&#39;. </span>
<span class="sd">        sum (bool, optional): For two-compartment tissues, set to True to return the total tissue concentration. Defaults to True.</span>
<span class="sd">        cv (array-like, optional): portal venous concentration for dual-inlet models. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: If sum=True, this is a 1D array with the total concentration at each time point. If sum=False this is the concentration in each compartment, and at each time point, as a 2D array with dimensions *(2,k)*, where *k* is the number of time points in *ca*. The concentration is returned in units of M.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Currently implemented kinetic models are: </span>
<span class="sd">        </span>
<span class="sd">        - &#39;EC&#39;: model for extracellular contrast agent. params = (ve, Te, De,) if cv=None (single-inlet model) and params = (Ta, af, Fp, ve,) otherwise (dual-inlet model).</span>
<span class="sd">        - &#39;IC&#39;: model for intracellular contrast agent. params = (ve, Te, De, khe, Th, ) if cv=None (single-inlet model and params = (Ta, af, Fp, ve, khe, Th,) otherwise (dual-inlet model). </span>
<span class="sd">        - &#39;ICNS&#39;: non-stationary model for intracellular contrast agent. params = (ve, Te, De, khe, Th, ) if cv=None (single-inlet model and params = (Ta, af, Fp, ve, khe, Th,) otherwise (dual-inlet model). In this case khe and Th are arrays with 2 or more values.</span>
<span class="sd">        - &#39;ICNSU&#39;: non-stationary uptake model for intracellular contrast agent. params = (ve, Te, De, khe, Th, ) if cv=None (single-inlet model and params = (Ta, af, Fp, ve, khe, Th,) otherwise (dual-inlet model). In this case khe is an array with 2 or more values.</span>

<span class="sd">        The model parameters are:</span>

<span class="sd">        - **Ta** (float, sec): Arterial transit time</span>
<span class="sd">        - **af** (float): Arterial flow fraction</span>
<span class="sd">        - **Fp** (float, mL/sec/mL): Plasma flow.</span>
<span class="sd">        - **ve** (float, mL/mL): liver extracellular volume fraction.</span>
<span class="sd">        - **De** (float): Extracellular dispersion in the range [0,1].</span>
<span class="sd">        - **Te** (float, sec): Extracellular mean transit time.</span>
<span class="sd">        - **khe** (float, mL/sec/mL): Intracellular uptake rate.</span>
<span class="sd">        - **Th** (float, sec): hepatocyte mean transit time.</span>

<span class="sd">    Example:</span>

<span class="sd">        Plot concentration in cortex and medulla for typical values:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import dcmri as dc</span>

<span class="sd">        Generate a population-average input function:</span>

<span class="sd">        &gt;&gt;&gt; t = np.arange(0, 30*60, 1.5)</span>
<span class="sd">        &gt;&gt;&gt; ca = dc.aif_parker(t, BAT=20)</span>

<span class="sd">        Define some parameters and generate plasma and tubular tissue concentrations with a non-stationary model:</span>

<span class="sd">        &gt;&gt;&gt; ve, Te, De, khe, Th = 0.2, 30, 0.5, [0.003, 0.01], [180, 600]</span>
<span class="sd">        &gt;&gt;&gt; C = dc.conc_liver(ca, ve, Te, De, khe, Th, t=t, sum=False, kinetics=&#39;ICNS&#39;)</span>

<span class="sd">        Plot all concentrations:</span>

<span class="sd">        &gt;&gt;&gt; fig, ax = plt.subplots(1,1,figsize=(6,5))</span>
<span class="sd">        &gt;&gt;&gt; ax.set_title(&#39;Kidney concentrations&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.plot(t/60, 1000*C[0,:], linestyle=&#39;--&#39;, linewidth=3.0, color=&#39;darkred&#39;, label=&#39;Extracellular&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.plot(t/60, 1000*C[1,:], linestyle=&#39;--&#39;, linewidth=3.0, color=&#39;darkblue&#39;, label=&#39;Hepatocytes&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.plot(t/60, 1000*(C[0,:]+C[1,:]), linestyle=&#39;-&#39;, linewidth=3.0, color=&#39;grey&#39;, label=&#39;Whole liver&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.set_xlabel(&#39;Time (min)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.set_ylabel(&#39;Tissue concentration (mM)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.legend()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">kinetics</span><span class="o">==</span><span class="s1">&#39;EC&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ve</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">De</span> <span class="o">=</span> <span class="n">params</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="n">ca</span>
            <span class="k">return</span> <span class="n">_conc_liver</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">extracellular</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">)],</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Fp</span><span class="p">,</span> <span class="n">ve</span>  <span class="o">=</span> <span class="n">params</span>
            <span class="k">return</span> <span class="n">_conc_liverav</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Fp</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">kinetics</span><span class="o">==</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ve</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">return</span> <span class="n">_conc_liver_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> 
                <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">)],</span>
                <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Th</span><span class="p">,)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">return</span> <span class="n">_conc_liverav_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> 
                <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> 
                <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> 
                <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">)],</span>
                <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Th</span><span class="p">,)])</span>
        
    <span class="k">elif</span> <span class="n">kinetics</span><span class="o">==</span><span class="s1">&#39;IC-HF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">return</span> <span class="n">_conc_liver_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> 
                <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> 
                <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">,</span> <span class="p">()],</span>
                <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Th</span><span class="p">,)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">return</span> <span class="n">_conc_liverav_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> 
                <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> 
                <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> 
                <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">,</span> <span class="p">()],</span>
                <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nscomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Th</span><span class="p">,)])</span>
        
    <span class="k">elif</span> <span class="n">kinetics</span><span class="o">==</span><span class="s1">&#39;ICNSU&#39;</span><span class="p">:</span>
        <span class="n">tarr</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">tarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ca</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ve</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">khe</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tarr</span><span class="p">):</span>
                <span class="n">khe</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">khe</span><span class="p">,</span> <span class="n">tarr</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_conc_liver_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> 
                <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">)],</span>
                <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Th</span><span class="p">,)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">khe</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tarr</span><span class="p">):</span>
                <span class="n">khe</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">khe</span><span class="p">,</span> <span class="n">tarr</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_conc_liverav_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> 
                <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> 
                <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> 
                <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">)],</span>
                <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nscomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Th</span><span class="p">,)])</span>
        
    <span class="k">elif</span> <span class="n">kinetics</span><span class="o">==</span><span class="s1">&#39;ICNS&#39;</span><span class="p">:</span>
        <span class="n">tarr</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">tarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ca</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ve</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">khe</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tarr</span><span class="p">):</span>
                <span class="n">khe</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">khe</span><span class="p">,</span> <span class="n">tarr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tarr</span><span class="p">):</span>
                <span class="n">Th</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">tarr</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_conc_liver_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> 
                <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> 
                <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">)],</span>
                <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nscomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Th</span><span class="p">,)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">khe</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tarr</span><span class="p">):</span>
                <span class="n">khe</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">khe</span><span class="p">,</span> <span class="n">tarr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tarr</span><span class="p">):</span>
                <span class="n">Th</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">tarr</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_conc_liverav_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> 
                <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> 
                <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> 
                <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Te</span><span class="p">,</span> <span class="n">De</span><span class="p">)],</span>
                <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nscomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">Th</span><span class="p">,)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Kinetic model &#39;</span> <span class="o">+</span> <span class="n">kinetics</span> <span class="o">+</span> <span class="s1">&#39; is not currently implemented.&#39;</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">_conc_liver</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> 
        <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">)],</span>
        <span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Single-inlet liver model modelling the extracellular space (gut and liver) as a plug-flow compartment.</span>

<span class="sd">    Args:</span>
<span class="sd">        ca (array_like): the indicator concentration in the plasma of the feeding artery, as a 1D array, in units of M.</span>
<span class="sd">        Te (float, sec): mean transit time of the extracellular space.</span>
<span class="sd">        De (float): Transit time dispersion of the extracellular space, in the range [0,1].</span>
<span class="sd">        ve (float): volume faction of the extracellular space.</span>
<span class="sd">        t (array_like, sec, optional): the time points in sec of the input function *ca*. If *t* is not provided, the time points are assumed to be uniformly spaced with spacing *dt*. Defaults to None.</span>
<span class="sd">        dt (float, sec, optional): spacing in seconds between time points for uniformly spaced time points. This parameter is ignored if *t* is explicity provided. Defaults to 1.0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: If sum=True, this is a 1D array with the total concentration at each time point. If sum=False this is the concentration in each compartment, and at each time point, as a 2D array with dimensions *(2,k)*, where 2 is the number of compartments and *k* is the number of time points in *ca*. The concentration is returned in units of M.</span>

<span class="sd">    Example:</span>

<span class="sd">        Plot concentration in the liver for typical values:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import dcmri as dc</span>

<span class="sd">        Generate a population-average input function:</span>

<span class="sd">        &gt;&gt;&gt; t = np.arange(0, 600, 1.5)</span>
<span class="sd">        &gt;&gt;&gt; ca = dc.aif_parker(t, BAT=20)</span>

<span class="sd">        Use the function to generate liver tissue concentrations:</span>

<span class="sd">        &gt;&gt;&gt; C = dc._conc_liver(ca, 0.3, extracellular=[&#39;pfcomp&#39;, (20, 0.5)], t=t)</span>

<span class="sd">        Plot all concentrations:</span>

<span class="sd">        &gt;&gt;&gt; fig, ax = plt.subplots(1,1,figsize=(6,5))</span>
<span class="sd">        &gt;&gt;&gt; ax.set_title(&#39;Liver concentrations&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.plot(t/60, 1000*C, linestyle=&#39;-&#39;, linewidth=3.0, color=&#39;darkviolet&#39;, label=&#39;Whole liver&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.set_xlabel(&#39;Time (min)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.set_ylabel(&#39;Tissue concentration (mM)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.legend()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Propagate through the extracellular space</span>
    <span class="n">ce</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="o">*</span><span class="n">extracellular</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">kinetics</span><span class="o">=</span><span class="n">extracellular</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Tissue concentration in the extracellular space</span>
    <span class="n">Ce</span> <span class="o">=</span> <span class="n">ve</span><span class="o">*</span><span class="n">ce</span>
    <span class="k">return</span> <span class="n">Ce</span>


<span class="k">def</span> <span class="nf">_conc_liverav</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">Ta</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Fp</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dual-inlet liver model for extracellular agents.&quot;&quot;&quot;</span>

    <span class="c1"># Propagate through arterial tree</span>
    <span class="n">ca</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">kinetics</span><span class="o">=</span><span class="s1">&#39;plug&#39;</span><span class="p">)</span>
    <span class="c1"># Determine inlet concentration</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">af</span><span class="o">*</span><span class="n">ca</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">af</span><span class="p">)</span><span class="o">*</span><span class="n">cv</span>
    <span class="c1"># Tissue concentration in the extracellular space</span>
    <span class="n">Te</span> <span class="o">=</span> <span class="n">ve</span><span class="o">/</span><span class="n">Fp</span>
    <span class="n">Ce</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">conc_comp</span><span class="p">(</span><span class="n">Fp</span><span class="o">*</span><span class="n">cp</span><span class="p">,</span> <span class="n">Te</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Ce</span>


<span class="k">def</span> <span class="nf">_conc_liver_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">)],</span>
        <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,)]):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Single-inlet liver model modelling the extracellular space (gut and liver) as a plug-flow compartment and the hepatocytes as a non-stationary compartment.</span>

<span class="sd">    Args:</span>
<span class="sd">        ca (array_like): the indicator concentration in the plasma of the feeding artery, as a 1D array, in units of M.</span>
<span class="sd">        Te (float, sec): mean transit time of the extracellular space.</span>
<span class="sd">        De (float): Transit time dispersion of the extracellular space, in the range [0,1].</span>
<span class="sd">        ve (float): volume faction of the extracellular space.</span>
<span class="sd">        khe (array-like, mL/sec/mL): array of rate constants for indicator transport from extracellular space to hepatocytes. </span>
<span class="sd">        Th (array-like, sec): array of mean transit times of the hepatocytes.</span>
<span class="sd">        t (array_like, sec, optional): the time points in sec of the input function *ca*. If *t* is not provided, the time points are assumed to be uniformly spaced with spacing *dt*. Defaults to None.</span>
<span class="sd">        dt (float, sec, optional): spacing in seconds between time points for uniformly spaced time points. This parameter is ignored if *t* is explicity provided. Defaults to 1.0.</span>
<span class="sd">        sum (bool, optional): if set to True, the total concentration is returned. If set to False, the concentration in the compartments is returned separately. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: If sum=True, this is a 1D array with the total concentration at each time point. If sum=False this is the concentration in each compartment, and at each time point, as a 2D array with dimensions *(2,k)*, where 2 is the number of compartments and *k* is the number of time points in *ca*. The concentration is returned in units of M.</span>

<span class="sd">    See Also:</span>
<span class="sd">        `liver_conc_pcc`</span>

<span class="sd">    Example:</span>

<span class="sd">        Plot concentration in the liver for typical values:</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import dcmri as dc</span>

<span class="sd">        Generate a population-average input function:</span>

<span class="sd">        &gt;&gt;&gt; t = np.arange(0, 1200, 1.5)</span>
<span class="sd">        &gt;&gt;&gt; ca = dc.aif_parker(t, BAT=20)</span>

<span class="sd">        In this case we can allow the function to change over the duration of the scan. Lets assume that the uptake and excretion functions are both inhibited at the start of the scan, and recover to normal values towards the end:</span>

<span class="sd">        &gt;&gt;&gt; khe = dc.interp([0.01, 0.2], t)</span>
<span class="sd">        &gt;&gt;&gt; Th = dc.interp([1800, 300], t)</span>

<span class="sd">        Use the function to generate liver tissue concentrations:</span>

<span class="sd">        &gt;&gt;&gt; C = dc._conc_liver_hep(ca, 0.3, khe, t, sum=False,</span>
<span class="sd">        ...     extracellular = [&#39;pfcomp&#39;, (20, 0.5)],</span>
<span class="sd">        ...     hepatocytes = [&#39;nscomp&#39;, Th],</span>
<span class="sd">        ... )</span>

<span class="sd">        Plot all concentrations:</span>

<span class="sd">        &gt;&gt;&gt; fig, ax = plt.subplots(1,1,figsize=(6,5))</span>
<span class="sd">        &gt;&gt;&gt; ax.set_title(&#39;Liver concentrations&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.plot(t/60, 1000*C[0,:], linestyle=&#39;-&#39;, linewidth=3.0, color=&#39;darkblue&#39;, label=&#39;Extracellular&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.plot(t/60, 1000*C[1,:], linestyle=&#39;--&#39;, linewidth=3.0, color=&#39;darkgreen&#39;, label=&#39;Hepatocytes&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.plot(t/60, 1000*(C[0,:]+C[1,:]), linestyle=&#39;-.&#39;, linewidth=3.0, color=&#39;darkviolet&#39;, label=&#39;Whole liver&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.set_xlabel(&#39;Time (min)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.set_ylabel(&#39;Tissue concentration (mM)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ax.legend()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Propagate through the extracellular space</span>
    <span class="n">ce</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="o">*</span><span class="n">extracellular</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">kinetics</span><span class="o">=</span><span class="n">extracellular</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Tissue concentration in the extracellular space</span>
    <span class="n">Ce</span> <span class="o">=</span> <span class="n">ve</span><span class="o">*</span><span class="n">ce</span>
    <span class="c1"># Tissue concentration in the hepatocytes</span>
    <span class="n">Ch</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">conc</span><span class="p">(</span><span class="n">khe</span><span class="o">*</span><span class="n">ce</span><span class="p">,</span> <span class="o">*</span><span class="n">hepatocytes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">kinetics</span><span class="o">=</span><span class="n">hepatocytes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ce</span><span class="o">+</span><span class="n">Ch</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Ce</span><span class="p">,</span><span class="n">Ch</span><span class="p">))</span>
    

<span class="k">def</span> <span class="nf">_conc_liverav_hep</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">ve</span><span class="p">,</span> <span class="n">khe</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">extracellular</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pfcomp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">)],</span>
        <span class="n">hepatocytes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,)]):</span>

    <span class="c1"># Propagate through arterial tree</span>
    <span class="n">ca</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">Ta</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">kinetics</span><span class="o">=</span><span class="s1">&#39;plug&#39;</span><span class="p">)</span>
    <span class="c1"># Determine inlet concentration</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">af</span><span class="o">*</span><span class="n">ca</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">af</span><span class="p">)</span><span class="o">*</span><span class="n">cv</span>
    <span class="c1"># Propagate through the extracellular space</span>
    <span class="n">ce</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="o">*</span><span class="n">extracellular</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">kinetics</span><span class="o">=</span><span class="n">extracellular</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Tissue concentration in the extracellular space</span>
    <span class="n">Ce</span> <span class="o">=</span> <span class="n">ve</span><span class="o">*</span><span class="n">ce</span>
    <span class="c1"># Tissue concentration in the hepatocytes</span>
    <span class="n">Ch</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">conc</span><span class="p">(</span><span class="n">khe</span><span class="o">*</span><span class="n">ce</span><span class="p">,</span> <span class="o">*</span><span class="n">hepatocytes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">kinetics</span><span class="o">=</span><span class="n">hepatocytes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Ce</span><span class="o">+</span><span class="n">Ch</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Ce</span><span class="p">,</span><span class="n">Ch</span><span class="p">))</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2024, dcmri maintainers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>